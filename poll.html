<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vote on this Poll</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } .result-bar-fill { transition: width 0.5s ease-in-out; } .image-preview { width: 40px; height: 40px; object-fit: cover; border-radius: 8px; margin-right: 12px; } </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div id="loading-section" class="text-center"> <p class="text-lg font-semibold">Loading Poll...</p> </div>
    <div class="w-full max-w-lg">
        <div id="vote-section" class="bg-white p-8 rounded-2xl shadow-lg hidden">
            <h2 id="vote-question" class="text-2xl font-bold text-gray-800 mb-6 text-center"></h2>
            <div id="vote-options-container" class="space-y-3"></div>
            <button onclick="submitVote()" class="w-full mt-6 bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600">Submit Vote</button>
            <p id="vote-error" class="text-red-500 text-center mt-4 hidden"></p>
        </div>
        <div id="results-section" class="bg-white p-8 rounded-2xl shadow-lg hidden">
            <h2 id="results-question" class="text-2xl font-bold text-gray-800 mb-6 text-center"></h2>
            <div id="results-container" class="space-y-4"></div>
            <p id="total-votes" class="text-center text-gray-500 mt-6 font-semibold"></p>
        </div>
    </div>
    <script>
        const API_URL = ''; let currentPoll = {};
        function showSection(sectionId) { ['vote-section', 'results-section'].forEach(id => document.getElementById(id).classList.add('hidden')); document.getElementById(sectionId).classList.remove('hidden'); }
        window.onload = async () => { const params = new URLSearchParams(window.location.search); const pollId = params.get('id'); if (!pollId) { document.getElementById('loading-section').innerText = 'Error: No Poll ID found in URL.'; return; } try { const response = await fetch(`${API_URL}/api/poll/${pollId}`); if (!response.ok) throw new Error('Poll not found.'); currentPoll = await response.json(); renderVoteScreen(); document.getElementById('loading-section').classList.add('hidden'); document.getElementById('vote-section').classList.remove('hidden'); } catch (error) { document.getElementById('loading-section').innerText = `Error: ${error.message}`; } };
        function renderVoteScreen() { document.getElementById('vote-question').textContent = currentPoll.question; const container = document.getElementById('vote-options-container'); container.innerHTML = ''; currentPoll.options.forEach((option, index) => { const imageUrl = option.image ? `${API_URL}/${option.image.replace(/\\/g, '/')}` : ''; const optionEl = document.createElement('label'); optionEl.className = 'flex items-center w-full px-5 py-4 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-600'; optionEl.innerHTML = `<input type="radio" name="vote_option" value="${index}" class="mr-3"> ${imageUrl ? `<img src="${imageUrl}" alt="${option.text}" class="image-preview">` : ''} <span class="font-medium text-gray-700">${option.text}</span>`; container.appendChild(optionEl); }); }
        async function submitVote() { const selectedOption = document.querySelector('input[name="vote_option"]:checked'); if (!selectedOption) { alert('Please select an option to vote.'); return; } const optionIndex = parseInt(selectedOption.value); try { const response = await fetch(`${API_URL}/api/poll/${currentPoll.id}/vote`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ optionIndex }) }); const result = await response.json(); if (!response.ok) { document.getElementById('vote-error').textContent = result.message; document.getElementById('vote-error').classList.remove('hidden'); if (response.status === 403) { setTimeout(() => { renderResultsScreen(currentPoll); showSection('results-section'); }, 2000); } return; } currentPoll = result; renderResultsScreen(currentPoll); showSection('results-section'); } catch (error) { alert('Error submitting vote: ' + error.message); } }
        function renderResultsScreen(poll) { document.getElementById('results-question').textContent = poll.question; const container = document.getElementById('results-container'); container.innerHTML = ''; const totalVotes = poll.options.reduce((sum, option) => sum + option.votes, 0); document.getElementById('total-votes').textContent = `Total Votes: ${totalVotes}`; poll.options.forEach(option => { const percentage = totalVotes > 0 ? (option.votes / totalVotes) * 100 : 0; const imageUrl = option.image ? `${API_URL}/${option.image.replace(/\\/g, '/')}` : ''; const resultEl = document.createElement('div'); resultEl.innerHTML = `<div class="flex justify-between items-center mb-1"><div class="flex items-center"> ${imageUrl ? `<img src="${imageUrl}" alt="${option.text}" class="image-preview">` : ''} <span class="font-semibold text-gray-700">${option.text}</span></div><span class="text-sm font-bold text-gray-600">${option.votes} votes (${percentage.toFixed(1)}%)</span></div><div class="w-full bg-gray-200 rounded-full h-4"><div class="bg-blue-500 h-4 rounded-full result-bar-fill" style="width: 0%;" data-width="${percentage.toFixed(1)}%"></div></div>`; container.appendChild(resultEl); }); setTimeout(() => { document.querySelectorAll('.result-bar-fill').forEach(bar => { bar.style.width = bar.dataset.width; }); }, 100); }
    </script>
</body>
</html>
